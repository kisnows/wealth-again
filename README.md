# 个人财富管理系统

## 项目概述

这是一个功能完整的个人财富管理系统，专为中国用户设计，基于 Next.js 15 + React 19 构建。系统帮助用户精确管理收入、投资组合，并根据中国税法进行税务计算。支持多城市税收政策、投资绩效分析和收入预测功能。

## 核心功能模块

### 🏛️ 仪表板 (`/dashboard`)
- **财务概览**：收入、投资、税务的全景视图
- **快速操作**：直达各功能模块的便捷入口
- **数据统计**：关键财务指标一目了然

### 💰 收入管理系统 (`/income`)

#### 基础功能
1. **月度收入记录**：记录每月的税前收入，支持工资、奖金等不同收入类型
2. **奖金管理**：季度奖金、年度奖金的单独录入和管理，支持提前录入未来奖金
3. **长期现金管理**：一次性大额收入（如年终奖、股权变现等）的专门管理
4. **收入变更历史**：完整的收入调整记录，支持生效日期管理

#### 高级功能  
5. **税后收入计算**：基于中国税法的精确税务计算，包含个人所得税、社保、公积金
6. **收入预测**：根据历史数据和政策变动预测未来收入，支持多时间段预测
7. **收入汇总统计** (`/income/summary`)：按月度、季度、年度的收入分析
8. **多币种支持**：支持不同货币的收入记录和汇率换算

#### 核心功能
1. **多账户管理**：支持券商账户、基金账户、理财账户等不同类型的投资账户
2. **交易记录管理**：完整记录存款(DEPOSIT)、取款(WITHDRAW)等资金流动
3. **估值快照系统**：定期记录账户总价值，用于精确的绩效计算
4. **投资绩效分析**：
   - **TWR (时间加权收益率)**：消除资金流入流出影响的标准收益率计算
   - **XIRR (扩展内部收益率)**：基于牛顿-拉夫逊方法的高精度计算
5. **账户详情页** (`/investment/accounts/[id]`)：单个账户的详细分析和历史追踪

#### 高级功能
6. **多货币投资支持**：支持不同货币的投资组合管理和汇率换算
7. **历史记录分页**：超过50条记录时自动分页，优化页面性能
8. **投资组合分析**：跨账户的综合绩效统计和风险评估

### 🏛️ 税务管理系统 (`/tax`)

#### 税务管理主页 (`/tax`)
- **税务概览仪表板**：当年累计税负、适用税率等关键指标
- **政策更新提醒**：最新税务政策变动通知
- **功能模块导航**：快速访问各税务管理功能

#### 税率管理 (`/tax/rates`)
1. **七级累进税率表**：完整的个人所得税税率管理
2. **税率计算示例**：不同收入水平的税负演示
3. **历史版本管理**：支持税率政策的时间版本控制
4. **实时编辑功能**：支持在线修改税率参数

#### 社保公积金管理 (`/tax/social-insurance`)
1. **多城市政策支持**：北京、上海、深圳、杭州等主要城市
2. **缴费基数管理**：社保和公积金的上下限配置
3. **缴费比例设置**：单位和个人承担比例的精确管理
4. **时间版本控制**：支持政策历史版本和未来政策预设
5. **计算示例展示**：不同工资水平的缴费演示

#### 基础配置 (`/tax/config`)
6. **专项附加扣除**：子女教育、住房贷款利息等扣除项配置
7. **全国统一政策**：起征点、费用扣除等基础参数管理

### ⚙️ 设置管理系统 (`/settings`)

#### 设置主页 (`/settings`)
- **账户概览**：用户基本信息和使用统计
- **快捷操作**：常用设置的快速入口
- **系统设置模块**：高级配置选项

#### 用户档案管理 (`/settings/profile`)
1. **个人信息管理**：姓名、邮箱等基础信息维护
2. **密码安全**：密码修改和安全策略设置
3. **账户设置**：双重认证、登录通知等安全功能
4. **数据管理**：个人数据导出和账户删除

#### 城市管理 (`/settings/city`)
1. **工作城市设置**：影响社保公积金计算的核心配置
2. **城市变更历史**：完整的城市切换记录和生效时间
3. **时间管理**：支持预设未来的城市变更计划
4. **政策自动适配**：城市变更自动切换相应的税务政策

#### 货币设置 (`/settings/currency`)
1. **多货币支持**：CNY、USD、EUR等主要货币
2. **实时汇率**：自动更新的汇率数据和24小时变化
3. **汇率计算器**：内置的货币换算工具
4. **显示偏好**：自定义显示货币种类和更新频率

## 技术特性

### 核心架构
- **前端框架**：Next.js 15 + React 19 (App Router)
- **后端API**：Next.js API 路由 + 中间件
- **数据库**：SQLite + Prisma ORM
- **身份验证**：NextAuth.js + Prisma适配器

### 样式与组件
- **CSS框架**：Tailwind CSS v4 - 最新版本的实用优先CSS框架
- **UI组件库**：shadcn/ui + Radix UI - 现代化的React组件库
- **数据验证**：Zod 架构验证 - 类型安全的数据验证

### 金融计算引擎
- **税务计算系统**：支持中国个人所得税累进计算的完整引擎
- **投资绩效算法**：自研TWR、XIRR算法，处理复杂投资场景
- **多货币支持**：汇率换算和多币种投资组合管理
- **时间管理**：支持历史政策版本和未来政策预设

### 测试与开发
- **测试框架**：Vitest (Node环境) - 现代化的单元测试框架
- **类型检查**：完整的TypeScript类型定义和检查
- **代码质量**：ESLint + 自动格式化配置

## 页面路由架构

系统采用优雅的层级路由设计，确保URL语义清晰且易于维护：

### 主要模块路由
```
/(dashboard)/
├── dashboard/              # 主仪表板
├── income/                 # 收入管理
│   └── summary/           # 收入汇总
├── investment/            # 投资管理  
│   └── accounts/[id]/     # 账户详情
├── tax/                   # 税务管理
│   ├── config/           # 基础配置
│   ├── rates/            # 税率管理
│   └── social-insurance/ # 社保公积金
└── settings/             # 系统设置
    ├── profile/          # 用户档案
    ├── city/             # 城市管理
    └── currency/         # 货币设置
```

### 身份验证路由
```
/(auth)/
├── login/     # 用户登录
└── register/  # 用户注册
```

## 开发命令

```bash
# 安装项目依赖
npm install

# 启动开发服务器（端口4000）
npm run dev

# 构建生产版本（包含Prisma生成）
npm run build

# 启动生产服务器
npm start

# 运行所有测试
npm run test

# 监听模式运行测试
npm run test:watch

# 运行测试UI界面
npm run test:ui

# 代码检查
npm run lint

# 自动修复代码格式问题
npm run lint:fix

# TypeScript类型检查
npm run type-check

# 生成Prisma客户端
npm run prisma:generate

# 运行数据库迁移
npm run prisma:migrate

# 打开Prisma Studio数据库管理界面
npm run prisma:studio

# 运行端到端测试
npm run playwright

# 账户去重脚本
npm run prisma:dedup-accounts
```

## 数据库设计

### 核心实体模型

**用户与认证**
- `User` - 系统用户，包含邮箱、密码、激活状态、当前城市等
- `UserCityHistory` - 用户城市变更历史，支持时间版本管理
- `AuditLog` - 完整的系统操作审计日志

**收入管理**  
- `IncomeRecord` - 月度收入记录，包含税前收入、奖金、社保等完整信息
- `IncomeChange` - 收入变更历史，支持生效日期
- `BonusPlan` - 奖金发放计划，支持未来奖金预录入

**投资管理**
- `Account` - 投资账户（券商、基金账户等），支持多货币
- `Transaction` - 金融交易记录（存款DEPOSIT、取款WITHDRAW）
- `ValuationSnapshot` - 账户估值快照，用于绩效计算

**税务配置**
- `TaxBracket` - 个人所得税税率档次，按城市和时间段管理
- `SocialInsuranceConfig` - 社保公积金配置，按城市管理
- `Config` - 系统级配置参数，支持时间范围有效性

**汇率与配置**
- `FxRate` - 货币汇率信息，支持多货币对
- `Config` - 系统配置，JSON格式存储复杂配置

## 项目特色

### 🇨🇳 中国本土化
- **税法合规**：完全基于中国个人所得税法的七级累进税率
- **社保政策**：支持全国主要城市的社保公积金政策
- **政策版本管理**：支持税务政策的历史版本和未来政策预设

### 📊 精确财务计算
- **税务引擎**：考虑专项附加扣除、五险一金的完整税务计算
- **投资绩效**：TWR和XIRR双重算法确保投资收益计算准确
- **时间管理**：基于生效日期的精确历史回溯和未来预测

### 🚀 现代技术栈  
- **最新框架**：Next.js 15 + React 19 的最新特性
- **类型安全**：完整的TypeScript覆盖和Zod验证
- **测试覆盖**：核心业务逻辑的全面单元测试

### 🎨 优雅设计
- **响应式布局**：完美适配桌面端和移动端
- **直观导航**：清晰的信息架构和用户流程
- **一致体验**：统一的设计语言和交互模式

## 使用场景

### 📈 个人理财师
- 精确计算不同收入水平的税负
- 制定个性化的税务优化方案  
- 跟踪投资组合的真实收益表现

### 💼 职场规划
- 评估跳槽或加薪对实际收入的影响
- 预测不同城市工作的收入差异
- 制定长期的财务规划目标

### 🏦 投资管理
- 管理多个投资账户的资金流水
- 计算考虑时间因素的真实投资收益
- 分析投资策略的历史表现

---

## 许可证

MIT License

## 贡献指南

欢迎提交 Issue 和 Pull Request 来改善这个项目。请确保您的代码符合项目的代码规范，并包含适当的测试。
