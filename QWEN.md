# Wealth-Again 项目简报

## 项目概述

Wealth-Again 是一个使用 Next.js、TypeScript 和 Prisma 构建的个人财富管理系统。该系统帮助用户跟踪收入、投资，并根据中国税法计算税务影响。它旨在为个人用户提供全面的财务管理解决方案，包括收入管理、投资组合跟踪和税务优化建议。

## 核心功能

整个项目在设计上需要支持多币种，因为我有人民币、港币、美元以及其他货币。

### 1. 收入管理

- 跟踪月薪、季度/年度奖金
- 根据中国税收制度计算税收扣除（社保、公积金、个人所得税）
- 预测年度收入和税收情况
- 管理收入变更历史和奖金计划

### 2. 投资管理

- 跟踪多个投资账户（如券商账户、基金账户等）
- 记录交易（存款、取款、不需要买卖交易）
- 根据账户的初始资金，以及存取款数据，计算任意时间的本金，根据用户提供的实时估值，来计算实际投资收益绝对值，以及收益率；
  - 比如初始资金为 1000，用户定期更新估值为 1200，如果这个过程中没有存取款记录，那么实际本金 1000，则收益为 200，收益率为 20%
    - 如果这个过程中有存取款记录，比如在估值为 1100 之前有存入 500 的记录，那么实际本金为 1500，收益为 1100-1500，收益为 -400，收益率为 -26.67%
    - 如果这个过程中有取款记录，比如在估值为 1300 之前取出 300，那么实际本金为 1000-300=700 ，收益为 1300-700=600，收益率为 600/1000=60%
    - 总之总体的计算公式为：
      - 任意时间的本金 = 初始资金 + 所有存款 - 所有取款
      - 收益 = 当前估值 - 实际本金
      - 收益率 = 收益 / 实际本金
- 跟踪投资组合估值变化
- 支持账户间转账和多货币处理

### 3. 税务参数配置

- 配置城市、年份、税率区间等税务参数
- 可视化展示税务参数（税率表、社保比例等）
- 以 JSON 格式保存和加载配置
- 支持不同城市的税务政策配置

## 技术架构

### 前端技术栈

- **框架**: Next.js 14 与 React 18
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **UI 组件**: shadcn/ui
- **数据可视化**: recharts
- **状态管理**: React 内置状态管理
- 依赖管理使用 pnpm

### 后端技术栈

- **API**: Next.js API 路由
- **认证**: NextAuth.js
- **数据库**: SQLite 与 Prisma ORM
- **数据验证**: Zod

### 开发工具

- **测试**: Vitest
- **类型检查**: TypeScript
- **代码检查**: ESLint
- **构建工具**: Next.js 内置构建系统

## 核心业务逻辑

### 税务计算

- 实现了符合中国税法的个人所得税计算逻辑
- 支持累计预扣法计算个税
- 自动计算社保和公积金扣除
- 支持专项附加扣除和其他法定扣除

## 开发和部署

### 常用开发命令

```bash
# 安装依赖
pnpm install

# 运行开发服务器
npm run dev

# 构建生产版本
npm run build

# 运行测试
npm run test

```

### 部署要求

- Node.js 运行环境
- SQLite 数据库（可替换为其他 Prisma 支持的数据库）
- 环境变量配置（数据库连接、认证密钥等）

## 项目结构

```
src/
├── app/                 # Next.js app router 页面和 API 路由
├── components/          # React UI 组件
│   ├── income/          # 收入管理相关组件
│   ├── investment/      # 投资管理相关组件
│   ├── tax/             # 税务相关组件
│   ├── ui/              # 通用UI组件
│   └── layout/          # 布局组件
├── lib/                 # 核心业务逻辑
│   ├── tax/             # 税务计算模块
│   ├── performance.ts   # 投资绩效计算
│   └── prisma.ts        # Prisma 客户端初始化
├── tests/               # 单元测试
└── prisma/              # Prisma 模式和迁移
```

## 测试方式

当你执行 `npm run dev` 启动开发服务器需要后台启动，否则会导致你被命令卡住。或者下判断 4000 端口是否有服务，如果有的话那就是已经启动的开发服务了，不需要你重新启动了。

可以通过打开 localhost:4000 来访问应用程序的本地开发版本。
测试挡路账号: yq123@outlook.com
密码: afjdlcs
